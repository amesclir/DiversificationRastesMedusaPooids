---
title: "DiversificationRatesMedusaPooids"
author: "amesclir"
date: "03/24/2015"
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

1. getting libraries and sources    

```{r}
library(ape)
library(geiger)
source("fitDiscrete.R")
source("medusa.R")
source("node.leaves.R")
```

2. getting trees and richness table

```{r}
mytree <- read.tree("mytree.tree")
mytrees <- read.tree("mytrees.tree")
richness <- read.csv("species_numbers_new.csv")
```

3. Prunning the trees

```{r}
tips <- richness[,2]
alltips <- mytrees[[1]]$tip.label
tipstoremove <- setdiff(alltips, tips)
mytree2 <- drop.tip(mytree, tipstoremove)
mytrees2 <- list()
for (i in 1:length(mytrees)) mytrees2[[i]] <- drop.tip(mytrees[[i]], tipstoremove)
class(mytrees2) <- "multiPhylo"
```

4. The analysis with one tree and one species richness (first GRIN database, then GGW database)

```{r}

#GRIN database
result1 <- runMedusa(mytree, richness[2:3], estimateExtinction=T, modelLimit=53, cutAtStem=T, startR = 0.05, startE = 0.5)
result2 <- summaryMedusa(mytree, richness[2:3], result1, cutoff=4, plotTree=F, useCorrection=F, cutAtStem=T)
#CGW database
result3 <- runMedusa(mytree, richness[-c(1,3:5,7:8)], estimateExtinction=T, modelLimit=53, cutAtStem=T, startR = 0.05, startE = 0.5)
result4 <- summaryMedusa(mytree, richness[-c(1,3:5,7:8)], result3, cutoff=4, plotTree=T, useCorrection=F, cutAtStem=T)


```

5. The analysis with one tree and 500 species richness (first GRIN database, then GGW database)

```{r}

richnessmatrix <- matrix(0, 26, 500)
for (i in 1:500) {
for (j in 1:26) richnessmatrix[j,i] <- as.matrix(sample(richness[j,4:5], 1))
}
   
richnessmatrix[,501] <- richness[,2]

result5 <- list()
for (i in 1:500) result5[[i]] <- runMedusa(mytree, cbind(richness[2],richnessmatrix[,i]), estimateExtinction=T, modelLimit=53, cutAtStem=T, startR = 0.05, startE = 0.5)
result6 <- list()
result6[[i]] <- summaryMedusa(mytree, cbind(richness[2],richnessmatrix[,i]), result5[[i]], cutoff=2, plotTree=F, useCorrection=F, cutAtStem=T)


```


6. More soon
